AGENT: architecture
FINDINGS:
- FINDING: CloneReinstallResult failure-reason dispatching repeated across 7 call sites
  SEVERITY: high
  FILES: src/commands/update.ts:113-140, src/commands/update.ts:193-219, src/commands/update.ts:254-291, src/commands/update.ts:341-375, src/commands/list-update-action.ts:38-68, src/commands/list-update-action.ts:113-142, src/commands/list-change-version-action.ts:54-84
  DESCRIPTION: The `CloneReinstallResult` discriminated union (defined in `src/clone-reinstall.ts:27-37`) has a `failureReason` field with five possible values. Every consumer of `cloneAndReinstall` must match on all five variants to convert them into the caller's local result type. This pattern is repeated identically in seven locations across three files. The c2 analysis flagged this exact issue; it remains unaddressed. The concrete cost: adding a sixth failure reason (e.g., "config-changed") would require updating all seven sites, and any site that misses a case silently falls through to a generic handler. The `clone-reinstall.ts` module was correctly extracted as a shared pipeline, but the result-to-outcome mapping layer above it was not. Each call site differs only in how it surfaces the outcome: `update.ts:runGitUpdate` throws ExitSignal, `update.ts:processGitUpdateForAll` returns PluginOutcome, `list-update-action.ts:runRemoteUpdate` returns UpdateActionResult, and `list-change-version-action.ts` returns ChangeVersionResult. The structure of the matching is the same in all cases.
  RECOMMENDATION: Define a generic result-mapping function, e.g., `mapCloneResult<T>(result: CloneReinstallResult, handlers: { onSuccess: (s) => T, onNoConfig: (key) => T, onNoAgents: (key) => T, ... }): T`. Each call site provides its thin handler record. This centralizes the exhaustive match, makes missing-case a compile error (if all handler keys are required), and reduces each call site from 30+ lines of matching to 5-10 lines of handler definitions. Alternatively, have each consumer context (update-command, list-update-action, list-change-version-action) define a single adapter function rather than inlining the match at every call.

- FINDING: `runGitUpdate` and `runLocalUpdate` in update.ts nearly identical to `processGitUpdateForAll` and `processLocalUpdateForAll`
  SEVERITY: medium
  FILES: src/commands/update.ts:101-156, src/commands/update.ts:176-232, src/commands/update.ts:242-306, src/commands/update.ts:308-398
  DESCRIPTION: `update.ts` contains four functions that orchestrate the same pipeline: `runGitUpdate` (single plugin, throws on failure), `runLocalUpdate` (single plugin local, throws on failure), `processGitUpdateForAll` (batch mode, returns PluginOutcome), `processLocalUpdateForAll` (batch mode, returns PluginOutcome). The git vs local split is already handled inside `cloneAndReinstall` via the `sourceDir` parameter, yet the call sites duplicate the local-path validation and the full failure-reason dispatch for both paths. The single vs batch difference is only in how outcomes surface (throw vs return). This means four functions exist where one function with a parameterized outcome strategy would suffice.
  RECOMMENDATION: Unify the git/local split by always delegating to `cloneAndReinstall` (which already handles both). Extract one `processUpdate(key, entry, projectDir)` function that returns a uniform `PluginOutcome`. The single-plugin path (`runUpdate` with a key) can call it and map PluginOutcome to throws/logs. The batch path can call it directly.

- FINDING: Summary render functions use `string[]` for agent parameters instead of `AgentId[]`
  SEVERITY: low
  FILES: src/summary.ts:138-139, src/summary.ts:155-156, src/summary.ts:175, src/summary.ts:180
  DESCRIPTION: `renderGitUpdateSummary`, `renderLocalUpdateSummary`, and `renderUpdateOutcomeSummary` declare `effectiveAgents: string[]` and `droppedAgents: string[]` in their input interfaces. Every caller passes `AgentId[]` values. Using `string[]` at the presentation boundary weakens the contract without justification -- these functions only receive agent IDs, and typing them as such would catch misuse at compile time (e.g., accidentally passing file paths).
  RECOMMENDATION: Change the interface fields to `AgentId[]` and import the type. This is a mechanical change with zero runtime impact.

SUMMARY: The dominant architectural issue remains the repeated CloneReinstallResult failure-reason dispatching across seven call sites in three files, compounded by the four near-identical update orchestration functions in update.ts. These were flagged in c2 and are still present. The rest of the architecture is sound -- clean module boundaries, proper discriminated unions, good type safety at core interfaces, and adequate integration test coverage.
